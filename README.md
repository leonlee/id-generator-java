id-generator-java
=================

ID generator implemented by Java

ID Server 策略与实现
Published by leon on Thursday, May 17, 2012 - 02:26:57
在互联网应用中，数据量巨大，一般会采取分区存放，集中展示的方式，这其中一个技术要点是ID的生成策略。在设计ID生成策略时需要考虑的问题大致如下：
全局唯一性： 不同分区不能产生ID碰撞冲突
全局可排序： 不同分区的数据支持统一排序
支持分区迁移： 支持逻辑数据分区，在新增物理分区的时候，可以通过迁移逻辑分区来均衡数据负载
索引优化： 大数据量下，为了优化查询速度索引一般需要常驻内存，所以索引所占用的空间越小越好
当前比较成熟的ID实现方案有Twitter的snowflake和MongoDB自带的ObjectId，其总体思路是采用
Timestamp + NodeID + Sequence:
Snowflake:
**********************************************************************
               T[41]                        +    N[10]    +    S[12]     
**********************************************************************
ID = TNS 长度为64bits，可以使用长度为64的long型表示
T: 时间戳毫秒数41bits（容量为69年）
N: 服务器ID 10bits（容量为1024）
S: Sequence 12bits（容量为4096）
并发：每台ID服务器可以在每秒生成4096000个ID，最多可以部署1024台ID生成服务器，总并发为4194304000/秒
容量： 69年,需要进行时间边界调整以使有效容量最大化
MongoDB ObjectId:
***************************************************************************
               T[32]          +      M[24]      +    P[16]      +    I[24]     
***************************************************************************
ID = TMPI 长度为96bits，可以使用长度为24的十六进制字符串表示
T: 时间戳秒数32bits
M: 机器ID 24bits（最大容量为16777216）
P: PID 16bits（容量为65536）
I: 累计计数器或者随机数24bits（容量为16777216）
并发：每台ID服务器的每个进程每秒可以生成16777216个唯一ID，每台机器的并发为1099511627776，总并发为18446744073709551616
容量：最大容量136年，截止到2038年1月19日3时14分07秒，没有进行边界调整，所以有效容量为26年
以上两种方案均适用于国外网络运营商骨干网没有出入口限制的环境，其中Twitter的方案相对高效，MongoDB的方案相对容量和并发量高一些；但是在国内当前运营商割据、存在出入口瓶颈的情况下，这两种方案无法实现跨运营商跨IDC的需求，为此针对国内状况，需要引入逻辑分区段来支持数据的分区以及数据迁移和数据均衡：
***************************************************************************
                   T[64]              + L[6]  + R[4] +    N[12]  +   S[10]     
***************************************************************************
ID = TLRNS 长度为96bits，可以使用长度为24的十六进制字符串表示
T: 时间戳毫秒数64bits（容量为584942417355年, 近于无限）
L: 逻辑分区6bits（容量为64），一般为运营商和区域的组合，如华东区电信机房
R: 保留位4bits（容量为16），可以为逻辑分区扩容，主要是凑足96bits 12个整字节
N: 机器节点12bits（容量为4096）
S: Sequence 计数器10bits（容量为1024）
并发：每台ID服务器每秒生成1024000个ID，总并发为4194304000/秒
容量：容量为584942417355年, 近于无限，无需调整时间边界
备注：如果对单台服务器的并发不满意，对逻辑分区没有过多业务需求，R位可以缩减为2bits，相应的扩展S为12bits
